<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <title>å¤–å›½èªç™ºéŸ³ãƒã‚§ãƒƒã‚¯</title>
    <script>
        let timer;

        function toggleRecording() {
            var button = document.getElementById("recordButton");
            var status = document.getElementById("recordingStatus");
            var countdown = document.getElementById("countdown");
            var evaluation = document.getElementById("evaluationStatus");

            if (button.innerText === "éŒ²éŸ³é–‹å§‹") {
                button.innerText = "éŒ²éŸ³åœæ­¢";
                status.style.display = "block"; // ğŸ”¹ ã€ŒéŒ²éŸ³ä¸­...ã€ã®è¡¨ç¤º
                countdown.style.display = "block"; // ğŸ”¹ ã‚«ã‚¦ãƒ³ãƒˆãƒ€ã‚¦ãƒ³è¡¨ç¤º
                evaluation.style.display = "none"; // ğŸ”¹ è©•ä¾¡ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã¯éè¡¨ç¤º

                var timeLeft = parseInt(document.getElementById("record_time").value);
                countdown.innerText = "æ®‹ã‚Šæ™‚é–“: " + timeLeft + "ç§’";

                timer = setInterval(function () {
                    timeLeft--;
                    countdown.innerText = "æ®‹ã‚Šæ™‚é–“: " + timeLeft + "ç§’";
                    if (timeLeft <= 0) {
                        clearInterval(timer);
                        stopRecording();
                    }
                }, 1000);
            } 
        }

        function stopRecording() {
            var button = document.getElementById("recordButton");
            var status = document.getElementById("recordingStatus");
            var countdown = document.getElementById("countdown");
            var evaluation = document.getElementById("evaluationStatus");

            button.innerText = "éŒ²éŸ³é–‹å§‹";
            status.style.display = "none"; // ğŸ”¹ éŒ²éŸ³çµ‚äº†æ™‚ã«éè¡¨ç¤º
            countdown.style.display = "none"; // ğŸ”¹ ã‚«ã‚¦ãƒ³ãƒˆãƒ€ã‚¦ãƒ³éè¡¨ç¤º
            evaluation.style.display = "block"; // ğŸ”¹ ã€Œè©•ä¾¡ä¸­...ã€ã®è¡¨ç¤ºã‚’ON

            // ğŸ”¹ 2ç§’å¾Œã«ãƒ•ã‚©ãƒ¼ãƒ ã‚’é€ä¿¡ï¼ˆè©•ä¾¡é–‹å§‹ï¼‰
            setTimeout(function () {
                document.getElementById("stopForm").submit();
            }, 2000);
        }
    </script>
</head>
<body>
    <h2>å¤–å›½èªç™ºéŸ³ãƒã‚§ãƒƒã‚¯</h2>

    <p>ä»¥ä¸‹ã®æ–‡ç« ã‚’éŸ³èª­ã—ã¦ãã ã•ã„:</p>
    <p><strong>{{ sentence }}</strong></p>

    <!-- ğŸ”¹ éŒ²éŸ³ï¼†è©•ä¾¡çŠ¶æ…‹ã®è¡¨ç¤º -->
    <p id="recordingStatus" style="display: none; color: red; font-weight: bold;">éŒ²éŸ³ä¸­...</p>
    <p id="countdown" style="display: none; font-weight: bold;"></p> <!-- ğŸ”¹ ã‚«ã‚¦ãƒ³ãƒˆãƒ€ã‚¦ãƒ³è¡¨ç¤º -->
    <p id="evaluationStatus" style="display: none; color: blue; font-weight: bold;">è©•ä¾¡ä¸­...</p> <!-- ğŸ”¹ è©•ä¾¡ä¸­è¡¨ç¤º -->

    <!-- éŒ²éŸ³ãƒœã‚¿ãƒ³ -->
    <button id="recordButton" onclick="toggleRecording()">éŒ²éŸ³é–‹å§‹</button>

    <!-- ğŸ”¹ åœæ­¢ï¼†è©•ä¾¡ãƒ•ã‚©ãƒ¼ãƒ  -->
    <form id="stopForm" action="/trans" method="post">
        <input type="hidden" name="language" value="{{ language }}">
        <input type="hidden" name="record_time" id="record_time" value="{{ record_time }}">
        <input type="hidden" name="index" value="{{ index }}">
    </form>

    <h2>ç™ºéŸ³ãƒã‚§ãƒƒã‚¯çµæœ</h2>
    <p>ä»¥ä¸‹ã«ã‚ãªãŸã®ç™ºéŸ³çµæœã‚’è¡¨ç¤ºã—ã¾ã™:</p>
    <div class="horizontal-container">
        {{ df_html|safe }}
    </div>

    {% if index+1 < num %}
    <form action="/trans" method="post">
        <input type="hidden" name="language" value="{{ language }}">
        <input type="hidden" name="record_time" value="{{ record_time }}">
        <input type="hidden" name="index" value="{{ index + 1 }}">
        <button type="submit">æ¬¡ã®æ–‡ã¸</button>
    </form>
    {% else %}
    <form action="/result" method="post">
        <button type="submit">ã™ã¹ã¦ã®è©•ä¾¡ãŒå®Œäº†ã—ã¾ã—ãŸ</button>
    </form>
    {% endif %}
</body>
</html>